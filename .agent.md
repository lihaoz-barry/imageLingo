# Universal AI Agent Guidelines

**This document applies to all AI coding agents: Claude Code, GitHub Copilot, Cursor, Continue, AutoGPT, and other LLM-based development tools.**

---

## ğŸ¯ Core Principle

Deliver code that is:
- âœ… **Type-safe**: Full TypeScript with proper interfaces
- âœ… **Tested**: Comprehensive test coverage before submission
- âœ… **Linted**: Zero ESLint errors, warnings acceptable
- âœ… **Documented**: Clear comments for complex logic
- âœ… **Secure**: No hardcoded secrets, proper validation

---

## ğŸ“‹ Mandatory Pre-Submission Workflow

### 1. Lint Check (Zero Errors Required)
```bash
npm run lint
```
- Exit code: 0
- Must show: "0 errors"
- Warnings (âš ï¸) are acceptable

### 2. Type Check (No Compilation Errors)
```bash
npx tsc --noEmit
```
- Exit code: 0
- No error messages
- Silent success is expected

### 3. Unit & Integration Tests (100% Pass Rate)
```bash
npm test
```
- All test files pass âœ…
- All individual tests pass âœ…
- Exit code: 0
- Coverage: minimum 70% for new code

### 4. Git Operations
```bash
# Only after all checks pass
git add <modified-files>
git commit -m "<message following format below>"
git push origin <branch-name>
```

---

## ğŸ“ Commit Message Format

```
<type>(<scope>): <description>

<body with bullet points>
- Change 1
- Change 2
- Change 3

<footer with sign-off>
Co-Authored-By: <Agent Name> <email@example.com>
```

### Commit Types
- `feat`: New feature
- `fix`: Bug fix
- `refactor`: Code reorganization
- `docs`: Documentation changes
- `test`: Test additions/modifications
- `perf`: Performance improvements
- `chore`: Build, CI/CD, tooling

---

## ğŸ—ï¸ Code Quality Standards

### TypeScript
```typescript
// âœ… DO
interface UserData {
  id: string;
  email: string;
  createdAt: Date;
}

const processUser = (user: UserData): Promise<void> => {
  // Implementation
};

// âŒ DON'T
const processUser = (user: any) => { };
const data: any = fetchData();
```

### React/Component Code
```typescript
// âœ… DO
interface ButtonProps {
  onClick: () => void;
  label: string;
}

const Button: React.FC<ButtonProps> = ({ onClick, label }) => {
  return <button onClick={onClick}>{label}</button>;
};

export default Button;

// âŒ DON'T
const Button = (props) => <button {...props} />;
export Button; // Wrong export
```

### API Routes
```typescript
// âœ… DO
export async function POST(req: NextRequest) {
  try {
    const { requireAdmin } = await import('@/lib/admin-middleware');
    const { response: authError } = await requireAdmin(req);
    if (authError) return authError;

    // Process request
    return Response.json({ success: true }, { status: 200 });
  } catch (error) {
    console.error('Error:', error);
    return Response.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

// âŒ DON'T
export async function POST(req: NextRequest) {
  const body = await req.json(); // No error handling
  // Direct database operation without auth check
}
```

### Testing
```typescript
// âœ… DO
describe('POST /api/endpoint', () => {
  it('should return 401 when not authenticated', async () => {
    vi.mocked(requireAuth).mockResolvedValue({
      response: Response.json({ error: 'Unauthorized' }, { status: 401 }),
      userId: null,
    });

    const response = await POST(mockRequest);
    expect(response.status).toBe(401);
  });

  it('should process valid request', async () => {
    vi.mocked(requireAuth).mockResolvedValue({
      response: null,
      userId: 'user-123',
    });

    const response = await POST(mockRequest);
    expect(response.status).toBe(200);
  });
});

// âŒ DON'T
test('works', async () => {
  const result = await POST(req);
  expect(result).toBeDefined();
});
```

---

## ğŸš« Actions NEVER Permitted

- âŒ Commit/push with ESLint errors
- âŒ Commit/push with TypeScript errors
- âŒ Commit/push with failing tests
- âŒ Hardcode credentials, API keys, or secrets
- âŒ Use `any` type without TSDoc explanation
- âŒ Skip tests for "simple" code
- âŒ Modify CI/CD workflows without justification
- âŒ Force push or rewrite history
- âŒ Delete important files without asking

---

## ğŸ” Code Review Checklist

Before submitting, verify:

### Functionality
- [ ] Feature works as specified
- [ ] Edge cases handled (null, empty, error states)
- [ ] Error messages are user-friendly
- [ ] Loading states shown where appropriate

### Type Safety
- [ ] No `any` types (except justified cases)
- [ ] All function parameters typed
- [ ] Return types specified
- [ ] Imports use `import type` for types

### Testing
- [ ] Happy path covered
- [ ] Error cases covered
- [ ] Mocks configured correctly
- [ ] No real API/database calls in tests

### Performance
- [ ] No unnecessary re-renders (React)
- [ ] Efficient database queries
- [ ] Proper pagination for lists
- [ ] Cache where appropriate

### Security
- [ ] Input validation present
- [ ] SQL injection prevented (using parameterized queries)
- [ ] XSS protected (escaped output)
- [ ] CSRF tokens used (if applicable)
- [ ] RLS policies enforced

### Documentation
- [ ] JSDoc comments for public functions
- [ ] Complex logic has inline comments
- [ ] New files have header comment
- [ ] API changes documented

---

## ğŸ“Š File Structure

```
imageLingo/
â”œâ”€â”€ app/                           # Next.js app directory
â”‚   â”œâ”€â”€ api/                      # API routes
â”‚   â”‚   â”œâ”€â”€ admin/               # Admin endpoints
â”‚   â”‚   â””â”€â”€ public/              # Public endpoints
â”‚   â””â”€â”€ page.tsx                 # Main page
â”œâ”€â”€ components/                   # React components
â”œâ”€â”€ hooks/                        # Custom React hooks
â”œâ”€â”€ lib/                          # Utilities & helpers
â”‚   â”œâ”€â”€ supabase-server.ts       # Supabase client
â”‚   â”œâ”€â”€ auth-middleware.ts       # Auth helpers
â”‚   â””â”€â”€ admin-middleware.ts      # Admin helpers
â”œâ”€â”€ __tests__/                    # Test files
â”‚   â”œâ”€â”€ api/
â”‚   â””â”€â”€ components/
â”œâ”€â”€ docs/                         # Documentation
â””â”€â”€ .github/                      # GitHub config
```

---

## ğŸ”— Key Resources

- **Type Definitions**: Check `lib/` for interfaces
- **Authentication**: See `lib/auth-middleware.ts`
- **Authorization**: See `lib/admin-middleware.ts`
- **Database**: See Supabase documentation + `lib/supabase-server.ts`
- **Testing**: Vitest + React Testing Library patterns

---

## âš¡ Quick Checklist (Copy This)

```bash
# Before EVERY commit, run:
npm run lint && npx tsc --noEmit && npm test

# Then:
git add <files>
git commit -m "type: description"
git push origin <branch>
```

---

## ğŸ“ Agent-Specific Instructions

- **Claude Code**: See `.claude-code-guidelines.md`
- **GitHub Copilot**: See `.github/copilot-instructions.md`
- **Cursor/Continue**: See `.cursor/rules.md` or `.continue/config.json`
- **AutoGPT**: Adapt these guidelines to your system prompt

---

**Last Updated: 2025-12-29**
**Applicable To: All AI agents and all PRs**
